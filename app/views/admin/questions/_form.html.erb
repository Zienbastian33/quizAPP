<%= form_with(model: [:admin, @quiz, question], class: "space-y-6") do |f| %>

  <%# ══ Errores ══ %>
  <% if question.errors.any? %>
    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
      <h3 class="text-red-800 font-semibold mb-2">
        Se encontraron <%= question.errors.count %> error(es):
      </h3>
      <ul class="list-disc pl-5 text-red-700 text-sm space-y-1">
        <% question.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <%# ══ Texto de la pregunta ══ %>
  <div>
    <%= f.label :body, "Pregunta", class: "block text-sm font-medium text-gray-700 mb-1" %>
    <%= f.text_area :body, rows: 3,
        placeholder: "Escribe la pregunta aquí...",
        class: "w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition resize-y" %>
  </div>

  <%# ══ Imagen (opcional) ══ %>
  <div>
    <%= f.label :image, "Imagen de la pregunta (opcional)", class: "block text-sm font-medium text-gray-700 mb-1" %>
    <% if question.image.attached? %>
      <div class="mb-2">
        <%= image_tag question.image, class: "h-32 rounded-lg object-cover" %>
      </div>
    <% end %>
    <%= f.file_field :image, accept: "image/*",
        class: "w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" %>
  </div>

  <%# ══ Video (opcional) ══ %>
  <div>
    <%= f.label :media, "Video o multimedia (opcional)", class: "block text-sm font-medium text-gray-700 mb-1" %>
    <% if question.media.attached? %>
      <div class="mb-2">
        <span class="text-sm text-green-600">✓ Archivo adjunto: <%= question.media.filename %></span>
      </div>
    <% end %>
    <%= f.file_field :media, accept: "video/*,audio/*",
        class: "w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" %>
  </div>

  <%# ══ Opciones de respuesta ══ %>
  <div>
    <label class="block text-sm font-medium text-gray-700 mb-3">
      Opciones de respuesta
      <span class="text-gray-400 font-normal">(marca la correcta)</span>
    </label>

    <%= f.fields_for :options do |option_f| %>
      <div class="flex items-center gap-3 mb-3">
        <%# Radio button para marcar la correcta %>
        <%= option_f.radio_button :correct, true,
            name: "question[options_attributes][correct_option]",
            checked: option_f.object.correct?,
            id: "correct_option_#{option_f.index}",
            class: "h-5 w-5 text-green-600 border-gray-300 focus:ring-green-500" %>

        <%# Texto de la opción %>
        <%= option_f.text_field :body,
            placeholder: "Opción #{option_f.index.to_i + 1}",
            class: "flex-1 px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition" %>

        <%# Hidden field para el id (necesario para editar opciones existentes) %>
        <%= option_f.hidden_field :id if option_f.object.persisted? %>
      </div>
    <% end %>

    <p class="text-xs text-gray-400 mt-1">
      Selecciona el radio button junto a la respuesta correcta.
      Completa las 4 opciones para poder publicar el quiz.
    </p>
  </div>

  <%# ══ Botones ══ %>
  <div class="flex gap-3 pt-2">
    <%= f.submit(question.persisted? ? "Actualizar Pregunta" : "Agregar Pregunta",
        class: "bg-indigo-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-indigo-700 focus:ring-4 focus:ring-indigo-200 transition cursor-pointer") %>
    <%= link_to "Cancelar", admin_quiz_path(@quiz),
        class: "bg-gray-100 text-gray-700 px-6 py-3 rounded-lg font-medium hover:bg-gray-200 transition" %>
  </div>
<% end %>
